module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("ethers")},function(e,t){e.exports=require("liteweb")},function(e,t){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,t){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,t){e.exports=require("@babel/runtime/helpers/createClass")},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return b}));var n=r(1),i=r.n(n),a=r(5),s=r.n(a),u=r(6),c=r.n(u),o=r(4),h=r.n(o),l=r(0),d=r.n(l),p=r(3),v=r.n(p),f=r(2),g=(f.utils.keccak256,f.utils.sha256);f.utils.toUtf8Bytes,f.utils.recoverAddress,f.utils.SigningKey,f.utils.AbiCoder;function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){h()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];s()(this,e),t=m(m({},t),{},{privateKey:u}),r=m(m({},r),{},{privateKey:u}),this.mainchain=new v.a(t),this.sidechain=new v.a(r),this.isAddress=this.mainchain.isAddress,this.utils=this.mainchain.utils,this.setMainGatewayAddress(n),this.setSideGatewayAddress(i),this.setChainId(a),this.injectPromise=this.utils.promiseInjector(this),this.validator=this.mainchain.xlt.validator;var c=this;this.sidechain.xlt.sign=function(){return c.sign.apply(c,arguments)},this.sidechain.xlt.multiSign=function(){return c.multiSign.apply(c,arguments)}}var t,r,n,a,u,o,h,l,p,f,y,b,x,w,k,P,T,K,j,O,A;return c()(e,[{key:"setMainGatewayAddress",value:function(e){if(!this.isAddress(e))throw new Error("Invalid main gateway address provided");this.mainGatewayAddress=e}},{key:"setSideGatewayAddress",value:function(e){if(!this.isAddress(e))throw new Error("Invalid side gateway address provided");this.sideGatewayAddress=e}},{key:"setChainId",value:function(e){if(!this.utils.isString(e)||!e)throw new Error("Invalid side chainId provided");this.chainId=e}},{key:"signTransaction",value:function(e,t){"string"==typeof e&&(e=this.utils.code.hexStr2byteArray(e));var r=this.utils.code.hexStr2byteArray(this.chainId),n=this.utils.code.hexStr2byteArray(t.txID).concat(r),i=g(n),a=this.utils.crypto.ECKeySign(this.utils.code.hexStr2byteArray(i.replace(/^0x/,"")),e);return Array.isArray(t.signature)?t.signature.includes(a)||t.signature.push(a):t.signature=[a],t}},{key:"multiSign",value:(A=i()(d.a.mark((function e(){var t,r,n,i,a,s,u,c=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]&&c[0],r=c.length>1&&void 0!==c[1]?c[1]:this.sidechain.defaultPrivateKey,n=c.length>2&&void 0!==c[2]&&c[2],i=c.length>3&&void 0!==c[3]&&c[3],this.utils.isFunction(n)&&(i=n,n=0),this.utils.isFunction(r)&&(i=r,r=this.mainchain.defaultPrivateKey,n=0),i){e.next=8;break}return e.abrupt("return",this.injectPromise(this.multiSign,t,r,n));case 8:if(this.utils.isObject(t)&&t.raw_data&&t.raw_data.contract){e.next=10;break}return e.abrupt("return",i("Invalid transaction provided"));case 10:return t.raw_data.contract[0].Permission_id=n,a=this.sidechain.address.toHex(this.sidechain.address.fromPrivateKey(r)).toLowerCase(),e.next=14,this.sidechain.xlt.getSignWeight(t,n);case 14:if("PERMISSION_ERROR"!==(s=e.sent).result.code){e.next=17;break}return e.abrupt("return",i(s.result.message));case 17:if(u=!1,s.permission.keys.map((function(e){e.address===a&&(u=!0)})),u){e.next=21;break}return e.abrupt("return",i(r+" has no permission to sign"));case 21:if(!s.approved_list||-1==s.approved_list.indexOf(a)){e.next=23;break}return e.abrupt("return",i(r+" already sign transaction"));case 23:if(!s.transaction||!s.transaction.transaction){e.next=28;break}(t=s.transaction.transaction).raw_data.contract[0].Permission_id=n,e.next=29;break;case 28:return e.abrupt("return",i("Invalid transaction provided"));case 29:return e.prev=29,e.abrupt("return",i(null,this.signTransaction(r,t)));case 33:e.prev=33,e.t0=e.catch(29),i(e.t0);case 36:case"end":return e.stop()}}),e,this,[[29,33]])}))),function(){return A.apply(this,arguments)})},{key:"sign",value:(O=i()(d.a.mark((function e(){var t,r,n,i,a,s,u=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]&&u[0],r=u.length>1&&void 0!==u[1]?u[1]:this.sidechain.defaultPrivateKey,n=!(u.length>2&&void 0!==u[2])||u[2],i=u.length>3&&void 0!==u[3]&&u[3],a=u.length>4&&void 0!==u[4]&&u[4],this.utils.isFunction(i)&&(a=i,i=!1),this.utils.isFunction(n)&&(a=n,n=!0,i=!1),this.utils.isFunction(r)&&(a=r,r=this.sidechain.defaultPrivateKey,n=!0,i=!1),a){e.next=10;break}return e.abrupt("return",this.injectPromise(this.sign,t,r,n,i));case 10:if(!this.utils.isString(t)){e.next=21;break}if(this.utils.isHex(t)){e.next=13;break}return e.abrupt("return",a("Expected hex message input"));case 13:return e.prev=13,s=this.sidechain.xlt.signString(t,r,n),e.abrupt("return",a(null,s));case 18:e.prev=18,e.t0=e.catch(13),a(e.t0);case 21:if(this.utils.isObject(t)){e.next=23;break}return e.abrupt("return",a("Invalid transaction provided"));case 23:if(i||!t.signature){e.next=25;break}return e.abrupt("return",a("Transaction is already signed"));case 25:if(e.prev=25,i){e.next=30;break}if(this.sidechain.address.toHex(this.sidechain.address.fromPrivateKey(r)).toLowerCase()===t.raw_data.contract[0].parameter.value.owner_address.toLowerCase()){e.next=30;break}return e.abrupt("return",a("Private key does not match address in transaction"));case 30:return e.abrupt("return",a(null,this.signTransaction(r,t)));case 33:e.prev=33,e.t1=e.catch(25),a(e.t1);case 36:case"end":return e.stop()}}),e,this,[[13,18],[25,33]])}))),function(){return O.apply(this,arguments)})},{key:"depositXlt",value:(j=i()(d.a.mark((function e(t,r,n){var i,a,s,u,c,o=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.length>3&&void 0!==o[3]?o[3]:{},a=o.length>4&&void 0!==o[4]?o[4]:this.mainchain.defaultPrivateKey,s=o.length>5&&void 0!==o[5]&&o[5],this.utils.isFunction(a)&&(s=a,a=this.mainchain.defaultPrivateKey),this.utils.isFunction(i)&&(s=i,i={}),s){e.next=7;break}return e.abrupt("return",this.injectPromise(this.depositXlt,t,r,n,i,a));case 7:if(!this.validator.notValid([{name:"callValue",type:"integer",value:t,gte:0},{name:"depositFee",type:"integer",value:r,gte:0},{name:"feeLimit",type:"integer",value:n,gt:0,lte:1e9}],s)){e.next=9;break}return e.abrupt("return");case 9:return i=m({callValue:Number(t)+Number(r),feeLimit:n},i),e.prev=10,e.next=13,this.mainchain.contract().at(this.mainGatewayAddress);case 13:return u=e.sent,e.next=16,u.depositXLT().send(i,a);case 16:return c=e.sent,e.abrupt("return",s(null,c));case 20:return e.prev=20,e.t0=e.catch(10),e.abrupt("return",s(e.t0));case 23:case"end":return e.stop()}}),e,this,[[10,20]])}))),function(e,t,r){return j.apply(this,arguments)})},{key:"depositTrc10",value:(K=i()(d.a.mark((function e(t,r,n,i){var a,s,u,c,o,h=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=h.length>4&&void 0!==h[4]?h[4]:{},s=h.length>5&&void 0!==h[5]?h[5]:this.mainchain.defaultPrivateKey,u=h.length>6&&void 0!==h[6]&&h[6],this.utils.isFunction(s)&&(u=s,s=this.mainchain.defaultPrivateKey),this.utils.isFunction(a)&&(u=a,a={}),u){e.next=7;break}return e.abrupt("return",this.injectPromise(this.depositTrc10,t,r,n,i,a,s));case 7:if(!this.validator.notValid([{name:"tokenValue",type:"integer",value:r,gte:0},{name:"depositFee",type:"integer",value:n,gte:0},{name:"feeLimit",type:"integer",value:i,gt:0,lte:1e9},{name:"tokenId",type:"integer",value:t,gte:0}],u)){e.next=9;break}return e.abrupt("return");case 9:return a=m(m({tokenId:t,tokenValue:r,feeLimit:i},a),{},{callValue:n}),e.prev=10,e.next=13,this.mainchain.contract().at(this.mainGatewayAddress);case 13:return c=e.sent,e.next=16,c.depositTRC10(t,r).send(a,s);case 16:o=e.sent,u(null,o),e.next=23;break;case 20:return e.prev=20,e.t0=e.catch(10),e.abrupt("return",u(e.t0));case 23:case"end":return e.stop()}}),e,this,[[10,20]])}))),function(e,t,r,n){return K.apply(this,arguments)})},{key:"depositTrc",value:(T=i()(d.a.mark((function e(t,r,n,i,a){var s,u,c,o,h,l,p=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=p.length>5&&void 0!==p[5]?p[5]:{},u=p.length>6&&void 0!==p[6]?p[6]:this.mainchain.defaultPrivateKey,c=p.length>7&&void 0!==p[7]&&p[7],this.utils.isFunction(u)&&(c=u,u=this.mainchain.defaultPrivateKey),this.utils.isFunction(s)&&(c=s,s={}),c){e.next=7;break}return e.abrupt("return",this.injectPromise(this.depositTrc,t,r,n,i,a,s,u));case 7:if(!this.validator.notValid([{name:"functionSelector",type:"not-empty-string",value:t},{name:"num",type:"integer",value:r,gte:0},{name:"fee",type:"integer",value:n,gte:0},{name:"feeLimit",type:"integer",value:i,gt:0,lte:1e9},{name:"contractAddress",type:"address",value:a}],c)){e.next=9;break}return e.abrupt("return");case 9:if(s=m(m({feeLimit:i},s),{},{callValue:n,tokenId:"",tokenValue:0}),e.prev=10,o=null,"approve"!==t){e.next=21;break}return e.next=15,this.mainchain.contract().at(a);case 15:return h=e.sent,e.next=18,h.approve(this.mainGatewayAddress,r).send(s,u);case 18:o=e.sent,e.next=44;break;case 21:return e.next=23,this.mainchain.contract().at(this.mainGatewayAddress);case 23:l=e.sent,e.t0=t,e.next="depositTRC20"===e.t0?27:"depositTRC721"===e.t0?31:"retryDeposit"===e.t0?35:"retryMapping"===e.t0?39:43;break;case 27:return e.next=29,l.depositTRC20(a,r).send(s,u);case 29:return o=e.sent,e.abrupt("break",44);case 31:return e.next=33,l.depositTRC721(a,r).send(s,u);case 33:return o=e.sent,e.abrupt("break",44);case 35:return e.next=37,l.retryDeposit(r).send(s,u);case 37:return o=e.sent,e.abrupt("break",44);case 39:return e.next=41,l.retryMapping(r).send(s,u);case 41:return o=e.sent,e.abrupt("break",44);case 43:return e.abrupt("break",44);case 44:c(null,o),e.next=50;break;case 47:return e.prev=47,e.t1=e.catch(10),e.abrupt("return",c(e.t1));case 50:case"end":return e.stop()}}),e,this,[[10,47]])}))),function(e,t,r,n,i){return T.apply(this,arguments)})},{key:"approveTrc20",value:(P=i()(d.a.mark((function e(t,r,n){var i,a,s,u,c=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>3&&void 0!==c[3]?c[3]:{},a=c.length>4&&void 0!==c[4]?c[4]:this.mainchain.defaultPrivateKey,s=c.length>5&&void 0!==c[5]&&c[5],u="approve",e.abrupt("return",this.depositTrc(u,t,0,r,n,i,a,s));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return P.apply(this,arguments)})},{key:"approveTrc721",value:(k=i()(d.a.mark((function e(t,r,n){var i,a,s,u,c=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>3&&void 0!==c[3]?c[3]:{},a=c.length>4&&void 0!==c[4]?c[4]:this.mainchain.defaultPrivateKey,s=c.length>5&&void 0!==c[5]&&c[5],u="approve",e.abrupt("return",this.depositTrc(u,t,0,r,n,i,a,s));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return k.apply(this,arguments)})},{key:"depositTrc20",value:(w=i()(d.a.mark((function e(t,r,n,i){var a,s,u,c,o=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>4&&void 0!==o[4]?o[4]:{},s=o.length>5&&void 0!==o[5]?o[5]:this.mainchain.defaultPrivateKey,u=o.length>6&&void 0!==o[6]&&o[6],c="depositTRC20",e.abrupt("return",this.depositTrc(c,t,r,n,i,a,s,u));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return w.apply(this,arguments)})},{key:"depositTrc721",value:(x=i()(d.a.mark((function e(t,r,n,i){var a,s,u,c,o=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>4&&void 0!==o[4]?o[4]:{},s=o.length>5&&void 0!==o[5]?o[5]:this.mainchain.defaultPrivateKey,u=o.length>6&&void 0!==o[6]&&o[6],c="depositTRC721",e.abrupt("return",this.depositTrc(c,t,r,n,i,a,s,u));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return x.apply(this,arguments)})},{key:"mappingTrc",value:(b=i()(d.a.mark((function e(t,r,n,i){var a,s,u,c,o,h=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=h.length>4&&void 0!==h[4]?h[4]:{},s=h.length>5&&void 0!==h[5]?h[5]:this.mainchain.defaultPrivateKey,u=h.length>6?h[6]:void 0,this.utils.isFunction(s)&&(u=s,s=this.mainchain.defaultPrivateKey),this.utils.isFunction(a)&&(u=a,a={}),u){e.next=7;break}return e.abrupt("return",this.injectPromise(this.mappingTrc,t,r,n,i,a,s));case 7:if(!this.validator.notValid([{name:"xltHash",type:"not-empty-string",value:t},{name:"mappingFee",type:"integer",value:r,gt:0},{name:"feeLimit",type:"integer",value:n,gt:0,lte:1e9}],u)){e.next=9;break}return e.abrupt("return");case 9:return t=t.startsWith("0x")?t:"0x"+t,a=m(m({feeLimit:n},a),{},{callValue:r}),e.prev=11,e.next=14,this.mainchain.contract().at(this.mainGatewayAddress);case 14:if(c=e.sent,o=null,"mappingTRC20"!==i){e.next=22;break}return e.next=19,c.mappingTRC20(t).send(a,s);case 19:o=e.sent,e.next=29;break;case 22:if("mappingTRC721"!==i){e.next=28;break}return e.next=25,c.mappingTRC721(t).send(a,s);case 25:o=e.sent,e.next=29;break;case 28:u(new Error("type must be trc20 or trc721"));case 29:u(null,o),e.next=35;break;case 32:return e.prev=32,e.t0=e.catch(11),e.abrupt("return",u(e.t0));case 35:case"end":return e.stop()}}),e,this,[[11,32]])}))),function(e,t,r,n){return b.apply(this,arguments)})},{key:"mappingTrc20",value:(y=i()(d.a.mark((function e(t,r,n){var i,a,s,u,c=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>3&&void 0!==c[3]?c[3]:{},a=c.length>4&&void 0!==c[4]?c[4]:this.mainchain.defaultPrivateKey,s=c.length>5&&void 0!==c[5]&&c[5],u="mappingTRC20",e.abrupt("return",this.mappingTrc(t,r,n,u,i,a,s));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return y.apply(this,arguments)})},{key:"mappingTrc721",value:(f=i()(d.a.mark((function e(t,r,n){var i,a,s,u,c=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>3&&void 0!==c[3]?c[3]:{},a=c.length>4&&void 0!==c[4]?c[4]:this.mainchain.defaultPrivateKey,s=c.length>5&&void 0!==c[5]&&c[5],u="mappingTRC721",e.abrupt("return",this.mappingTrc(t,r,n,u,i,a,s));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return f.apply(this,arguments)})},{key:"withdrawXlt",value:(p=i()(d.a.mark((function e(t,r,n){var i,a,s,u,c,o=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.length>3&&void 0!==o[3]?o[3]:{},a=o.length>4&&void 0!==o[4]?o[4]:this.mainchain.defaultPrivateKey,s=o.length>5&&void 0!==o[5]&&o[5],this.utils.isFunction(a)&&(s=a,a=this.mainchain.defaultPrivateKey),this.utils.isFunction(i)&&(s=i,i={}),s){e.next=7;break}return e.abrupt("return",this.injectPromise(this.withdrawXlt,t,r,n,i,a));case 7:if(!this.validator.notValid([{name:"callValue",type:"integer",value:t,gte:0},{name:"withdrawFee",type:"integer",value:r,gte:0},{name:"feeLimit",type:"integer",value:n,gt:0,lte:1e9}],s)){e.next=9;break}return e.abrupt("return");case 9:return i=m({callValue:Number(t)+Number(r),feeLimit:n},i),e.prev=10,e.next=13,this.sidechain.contract().at(this.sideGatewayAddress);case 13:return u=e.sent,e.next=16,u.withdrawXLT().send(i,a);case 16:return c=e.sent,e.abrupt("return",s(null,c));case 20:return e.prev=20,e.t0=e.catch(10),e.abrupt("return",s(e.t0));case 23:case"end":return e.stop()}}),e,this,[[10,20]])}))),function(e,t,r){return p.apply(this,arguments)})},{key:"withdrawTrc10",value:(l=i()(d.a.mark((function e(t,r,n,i){var a,s,u,c,o,h=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=h.length>4&&void 0!==h[4]?h[4]:{},s=h.length>5&&void 0!==h[5]?h[5]:this.mainchain.defaultPrivateKey,u=h.length>6&&void 0!==h[6]&&h[6],this.utils.isFunction(s)&&(u=s,s=this.mainchain.defaultPrivateKey),this.utils.isFunction(a)&&(u=a,a={}),u){e.next=7;break}return e.abrupt("return",this.injectPromise(this.withdrawTrc10,t,r,n,i,a,s));case 7:if(!this.validator.notValid([{name:"tokenId",type:"integer",value:t,gte:0},{name:"tokenValue",type:"integer",value:r,gte:0},{name:"withdrawFee",type:"integer",value:n,gte:0},{name:"feeLimit",type:"integer",value:i,gt:0,lte:1e9}],u)){e.next=9;break}return e.abrupt("return");case 9:return a=m({tokenValue:r,tokenId:t,callValue:n,feeLimit:i},a),e.prev=10,e.next=13,this.sidechain.contract().at(this.sideGatewayAddress);case 13:return c=e.sent,e.next=16,c.withdrawTRC10(t,r).send(a,s);case 16:return o=e.sent,e.abrupt("return",u(null,o));case 20:return e.prev=20,e.t0=e.catch(10),e.abrupt("return",u(e.t0));case 23:case"end":return e.stop()}}),e,this,[[10,20]])}))),function(e,t,r,n){return l.apply(this,arguments)})},{key:"withdrawTrc",value:(h=i()(d.a.mark((function e(t,r,n,a,s){var u,c,o,h,l,p,v,f,g,y,b=this,x=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=x.length>5&&void 0!==x[5]?x[5]:{},c=x.length>6&&void 0!==x[6]?x[6]:this.mainchain.defaultPrivateKey,o=x.length>7&&void 0!==x[7]&&x[7],this.utils.isFunction(c)&&(o=c,c=this.mainchain.defaultPrivateKey),this.utils.isFunction(u)&&(o=u,u={}),o){e.next=7;break}return e.abrupt("return",this.injectPromise(this.withdrawTrc,t,r,n,a,s,u,c));case 7:if(!this.validator.notValid([{name:"functionSelector",type:"not-empty-string",value:t},{name:"numOrId",type:"integer",value:r,gte:0},{name:"withdrawFee",type:"integer",value:n,gte:0},{name:"feeLimit",type:"integer",value:a,gt:0,lte:1e9},{name:"contractAddress",type:"address",value:s}],o)){e.next=9;break}return e.abrupt("return");case 9:return u=m(m({feeLimit:a},u),{},{callValue:n}),h=[{type:"uint256",value:r}],e.prev=11,l=c?this.sidechain.address.fromPrivateKey(c):this.sidechain.defaultAddress.base58,e.next=15,this.sidechain.transactionBuilder.triggerSmartContract(s,t,u,h,this.sidechain.address.toHex(l));case 15:if((p=e.sent).result&&p.result.result){e.next=18;break}return e.abrupt("return",o("Unknown error: "+JSON.stringify(p.transaction,null,2)));case 18:return e.next=20,this.sidechain.xlt.sign(p.transaction,c);case 20:if((v=e.sent).signature){e.next=25;break}if(c){e.next=24;break}return e.abrupt("return",o("Transaction was not signed properly"));case 24:return e.abrupt("return",o("Invalid private key provided"));case 25:return e.next=27,this.sidechain.xlt.sendRawTransaction(v);case 27:if(!(f=e.sent).code){e.next=32;break}return g={error:f.code,message:f.code},f.message&&(g.message=this.sidechain.toUtf8(f.message)),e.abrupt("return",o(g));case 32:if(u.shouldPollResponse){e.next=34;break}return e.abrupt("return",o(null,v.txID));case 34:(y=function(){var e=i()(d.a.mark((function e(){var t,r,n,i=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(20!=(t=i.length>0&&void 0!==i[0]?i[0]:0)){e.next=3;break}return e.abrupt("return",o({error:"Cannot find result in solidity node",transaction:v}));case 3:return e.next=5,b.sidechain.xlt.getTransactionInfo(v.txID);case 5:if(r=e.sent,Object.keys(r).length){e.next=8;break}return e.abrupt("return",setTimeout((function(){y(t+1)}),3e3));case 8:if(!r.result||"FAILED"!=r.result){e.next=10;break}return e.abrupt("return",o({error:b.sidechain.toUtf8(r.resMessage),transaction:v,output:r}));case 10:if(utils.hasProperty(r,"contractResult")){e.next=12;break}return e.abrupt("return",o({error:"Failed to execute: "+JSON.stringify(r,null,2),transaction:v,output:r}));case 12:if(!u.rawResponse){e.next=14;break}return e.abrupt("return",o(null,r));case 14:return 1===(n=decodeOutput(b.outputs,"0x"+r.contractResult[0])).length&&(n=n[0]),e.abrupt("return",o(null,n));case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())(),e.next=41;break;case 38:return e.prev=38,e.t0=e.catch(11),e.abrupt("return",o(e.t0));case 41:case"end":return e.stop()}}),e,this,[[11,38]])}))),function(e,t,r,n,i){return h.apply(this,arguments)})},{key:"withdrawTrc20",value:(o=i()(d.a.mark((function e(t,r,n,i,a){var s,u,c,o=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=o.length>5&&void 0!==o[5]?o[5]:this.mainchain.defaultPrivateKey,u=o.length>6&&void 0!==o[6]&&o[6],c="withdrawal(uint256)",e.abrupt("return",this.withdrawTrc(c,t,r,n,i,a,s,u));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,i){return o.apply(this,arguments)})},{key:"withdrawTrc721",value:(u=i()(d.a.mark((function e(t,r,n,i,a){var s,u,c,o=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=o.length>5&&void 0!==o[5]?o[5]:this.mainchain.defaultPrivateKey,u=o.length>6&&void 0!==o[6]&&o[6],c="withdrawal(uint256)",e.abrupt("return",this.withdrawTrc(c,t,r,n,i,a,s,u));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,i){return u.apply(this,arguments)})},{key:"injectFund",value:(a=i()(d.a.mark((function e(t,r,n){var i,a,s,u,c,o,h,l,p=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=p.length>3&&void 0!==p[3]?p[3]:this.mainchain.defaultPrivateKey,a=p.length>4&&void 0!==p[4]&&p[4],this.utils.isFunction(i)&&(a=i,i=this.mainchain.defaultPrivateKey),this.utils.isFunction(n)&&(a=n,n={}),a){e.next=6;break}return e.abrupt("return",this.injectPromise(this.injectFund,t,r,n,i));case 6:if(!this.validator.notValid([{name:"num",type:"integer",value:t,gte:0},{name:"feeLimit",type:"integer",value:r,gt:0,lte:1e9}],a)){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,s=this.sidechain.address.fromPrivateKey(i),u=this.sidechain.address.toHex(s),e.next=13,this.sidechain.fullNode.request("/wallet/fundinject",{owner_address:u,amount:t},"post");case 13:return c=e.sent,e.next=16,this.sidechain.xlt.sign(c,i);case 16:if((o=e.sent).signature){e.next=21;break}if(i){e.next=20;break}return e.abrupt("return",a("Transaction was not signed properly"));case 20:return e.abrupt("return",a("Invalid private key provided"));case 21:return e.next=23,this.sidechain.xlt.sendRawTransaction(o);case 23:if(!(h=e.sent).code){e.next=28;break}return l={error:h.code,message:h.code},h.message&&(l.message=this.mainchain.toUtf8(h.message)),e.abrupt("return",a(l));case 28:return e.abrupt("return",a(null,o.txID));case 31:return e.prev=31,e.t0=e.catch(8),e.abrupt("return",a(e.t0));case 34:case"end":return e.stop()}}),e,this,[[8,31]])}))),function(e,t,r){return a.apply(this,arguments)})},{key:"retryWithdraw",value:(n=i()(d.a.mark((function e(t,r,n){var i,a,s,u,c=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>3&&void 0!==c[3]?c[3]:{},a=c.length>4&&void 0!==c[4]?c[4]:this.sidechain.defaultPrivateKey,s=c.length>5&&void 0!==c[5]&&c[5],u="retryWithdraw(uint256)",e.abrupt("return",this.withdrawTrc(u,t,r,n,this.sideGatewayAddress,i,a,s));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"retryDeposit",value:(r=i()(d.a.mark((function e(t,r,n){var i,a,s,u,c=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>3&&void 0!==c[3]?c[3]:{},a=c.length>4&&void 0!==c[4]?c[4]:this.mainchain.defaultPrivateKey,s=c.length>5&&void 0!==c[5]&&c[5],u="retryDeposit",e.abrupt("return",this.depositTrc(u,t,r,n,this.mainGatewayAddress,i,a,s));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"retryMapping",value:(t=i()(d.a.mark((function e(t,r,n){var i,a,s,u,c=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>3&&void 0!==c[3]?c[3]:{},a=c.length>4&&void 0!==c[4]?c[4]:this.mainchain.defaultPrivateKey,s=c.length>5&&void 0!==c[5]&&c[5],u="retryMapping",e.abrupt("return",this.depositTrc(u,t,r,n,this.mainGatewayAddress,i,a,s));case 5:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})}]),e}();h()(b,"LiteWeb",v.a)}]).default;
//# sourceMappingURL=SolWeb.node.js.map